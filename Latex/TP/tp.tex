\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage[legalpaper, margin=0.5in]{geometry}
\usepackage{amsmath, amssymb, amsthm}
\usepackage{graphicx, float}
\usepackage{tabularx}   % Paquete para hacer las tablas
\usepackage{array}      % Paquete para 
\usepackage{changepage} % Paquete para cambiar la ubicacion de palabras en el margen
\usepackage{relsize}
\usepackage[absolute,overlay]{textpos}
\usepackage{dsfont}
\usepackage{textcomp}
\usepackage{transparent}
\usepackage{indentfirst}

\graphicspath{{images/}}

%Macros para el TP%
\newcommand{\Entero}{$\mathds{Z}$}
\newcommand{\Natural}{$\mathds{N}$}
\newcommand{\tuplaDeDosEnteros}{Seq\textless\Entero\texttimes\Entero\textgreater}
\newcommand{\tuplaDeCuatroEnteros}{Seq\textless\Entero\texttimes\Entero\texttimes\Entero\texttimes\Entero\textgreater}
\newcommand{\tuplaDeTuplaDeCuatroEnteros}{{Seq\textless Seq\textless\Entero\texttimes\Entero\texttimes\Entero\texttimes\Entero\textgreater\textgreater}}


\begin{document}
\thispagestyle{empty}
\section*{Trabajo Práctico 1: Especificación de TADs}
\subsection*{Cómo funcionan las Blockchains: \textdollar BerretaCoin}

\begin{textblock*}{16cm} (13cm, 0cm)
    \includegraphics[width=0.5\textwidth]{dc_logo.png}
\end{textblock*}


\noindent\makebox[\linewidth]{\rule{\paperwidth}{0.4pt}}

%Grupo
\begin{textblock*}{15cm} (8.67cm, 10cm)
    \textbf{Grupo: Ameri}
\end{textblock*}

% Cuadro de integrantes
\begin{textblock*}{14.5cm} (3.4cm, 12cm)
\begin{table}[h]
\centering
\begin{tabular}{|>{\vspace{1mm}\centering\arraybackslash}m{2.8cm} >{\vspace{2mm}\arraybackslash}m{1cm} >{\vspace{2mm}\arraybackslash}m{3cm}|}
    \hline
    Integrante & LU & Correo electrónico \\ [0.1cm]
    \hline
\end{tabular}
\begin{tabular}{|>{\vspace{1mm}\centering\arraybackslash}m{2.5cm} >{\vspace{1mm}\centering\arraybackslash}m{1cm} >{\vspace{2mm}\centering\arraybackslash}m{3.3cm}|}
    \hline
    Rankov, Jorge & 714/23 & jrankov@dc.uba.ar \\ [0.2ex]
    Falbo, Tiziana & nnn/nn & nnn@gmail.com \\ [0.3ex]
    Facundo & nnn/nn & nnn@gmail.com \\ [0.3ex]
    Bautista & nnn/nn & nnn@gmail.com \\ [0.3ex]
    \hline
\end{tabular}
\end{table}
\end{textblock*}

% Logo UBA
\begin{textblock*}{17cm} (1cm, 22cm)
    {\transparent{0.2}
    \includegraphics[width=0.5\textwidth]{uba_logo.jpg}
    }
\end{textblock*}

% Texto UBA
\begin{textblock*}{20cm} (12cm, 25.5cm)
    {\raggedright\textbf{Facultad de Ciencias Exactas y Naturales}\\
    \textbf{Universidad de Buenos Aires}\\
    Ciudad Universitaria $-$ (Pabellon I/Planta Baja)\\
    Intendente Guiraldes 2610 $-$ C1428EGA\\
    Ciudad Autónoma de Buenos Aires $-$ Rep. Argentina\\
    Tel/Fax: (+54) 11 4576$-$3300\\
    http://www.exactas.uba.ar
    }
\end{textblock*}



\newpage












 % Fin de Titulo, inicio de Formulas y Funciones
\setcounter{page}{1}
\section*{TAD \textdollar BerretaCoin \{}
    %Obs
    \textbf{obs blockchain:} Seq$<$bloques$>$\\\\

    \textbf{proc nuevoBerretaCoin()}: BerretaCoin \{\\
        \indent\indent \textbf{asegura} \{ res.blockchain = $<>$ \}

    \}\\\\

    \textbf{proc agregarBloque} (inout B: BerretaCoin, in S: bloque) \{\\
        \indent\indent\textbf{requiere} \{ $B = B_0 \land (0 < |$S.transacciones$| \leq$ 50) $\land$ bloqueValido(B, S) $\land$ sonTransaccionesValidas(S, B) \}\\

        \indent\indent\textbf{asegura} \{ B.blockchain = B${_0}$.blockchain ++ \{S\} \}

    \}\\\\

    \textbf{proc maximosTenedores} (in B: BerretaCoin): Seq$<$\Entero$>$ \{

        \indent\indent\textbf{asegura} \{ $(\forall$i: \Entero)(0 $\le i < |res|) \rightarrow$
                                            esUsuario $(res_{[i]}$, B) \}\\

        \indent\indent\textbf{asegura} \{ $(\forall$id: \Entero) (id $\in$ res) $\rightarrow$
                                         $\neg$ ($\exists$ otro: \Entero) (esUsuario (otro, B)) $\land$\\
        \indent\indent\indent\indent\indent (montoDeUsuario (otro, B) $\ge$ montoDeUsuario (id, B)) \}\\

        \indent\indent\textbf{asegura} \{ $(\forall$i: \Entero)$(\forall$j: \Entero) (0 $\le i < |res|)$ $\land$ (0 $\le j < |res|)$ $\land$ (i $\ne$ j) $\rightarrow$ res$_{[i]}$ $\ne$ res$_{[j]}$ \}

    \}\\\\

    \textbf{proc montoMedio} (in B: BerretaCoin): Float \{\\
        \indent\indent \textbf{requiere} \{ $|$B.blockchain$| \ne 0$ \}\\\\
        \indent\indent \textbf{asegura} \{ res = promedio (B.blockchain) \}

    \}\\\\

    \textbf{proc cotizacionAPesos} (in cotizaciones: Seq$<$\Entero$>$, in B: BerretaCoin): Seq$<$\Entero$>$ \{\\
        \indent\indent \textbf{requiere} \{ $(\forall$C $\in$ cotizaciones) (C $>$ 0) \}\\

        \indent\indent \textbf{requiere} \{ $|$cotizaciones$|$ = $|$B.blockchain$|$ \}\\

        \indent\indent \textbf{asegura} \{ $|$res$|$ = $|$cotizaciones$|$ \}\\

        \indent\indent \textbf{asegura} \{ $(\forall i: $\Entero)(0 $\le i < |$res$|)\rightarrow$ res$_{[i]}$ = cotizarBloque (i, cotizaciones, B.blockchain) \}

    \}\\\\

    







\newpage
\section*{Predicados}

    \textbf{pred bloqueValido} (B: BerretaCoin, S: bloque) \{\\
        \indent\indent ($|$B.blockchain$|<$ 3000) $\rightarrow$ S.transacciones$_{[0]}$.idComprador = 0 $\land$

        \indent\indent ($|$B.blockchain$|\ge$ 3000) $\rightarrow$ S.transacciones$_{[0]}$.idComprador $\ne$ 0 $\land$

        \indent\indent ($|S.transacciones| \le$ 50)\\
        \indent\indent$\land$\\
        \indent\indent[($\forall$ transaccion $\in$ S.transacciones) $\rightarrow$ [(transaccion.idComprador $\ne$ transaccion.idVendedor) $\land$

        \indent\indent(transaccion.id $>$ 0 $\land$ transaccion.idComprador $\ge$ 0 $\land$ transaccion.idVendedor $>$ 0 $\land$ transaccion.monto $>$ 0)] $\land$

        \indent\indent estaOrdenada(S) $\land$ esIdDeBloqueConsecutivo(B, S)

    \}\\\\

    \textbf{pred estaOrdenada} (S: bloque) \{\\
        \indent\indent $(\forall i$: \Entero) (0 $\le$ i $< |$S.transacciones$|$) $\rightarrow$ (S.transacciones$_{[i]}$.idTransaccion = $i$)

    \}\\\\

    \textbf{pred esIdDeBloqueConsecutivo} (B: BerretaCoin, S: bloque) \{\\
        \indent\indent ($|$B.blockchain$| = 0)\rightarrow$ (S.idBloque = 0) $\land$\\
        \indent\indent ($|$B.blockchain$| \ne 0) \rightarrow$ (S.idBloque = B.blockchain[ $|$B.blockchain$|-$1 ].idBloque + 1)

    \}\\\\

    \textbf{pred sonTransaccionesValidas} (S: bloque, B: blockchain) \{\\
        \indent\indent ($\forall id:$\Entero)($\forall j:$\Entero)(0 $\le$ j $<|$S.transacciones$|$) [esUsuario(id, B) $\lor$ esUsuarioDeBloque(id, S)]
        
        \indent\indent\indent\indent\indent\indent\indent $\rightarrow$ montoDeUsuarioHastaTransaccion(id, S, B, j) $\ge$ 0

    \}\\\\

    \textbf{pred esUsuario} (id: \Entero, B: BerretaCoin) \{\\
        \indent\indent($\exists$i: \Entero)($\exists$j: \Entero) (0 $\leq$ i $< |$b.blockchain$|$ $\land$ 0 $\le$ j $< |$b.blockchain$_{[i]}$.transacciones$|$) $\land$

        \indent\indent(id = b.blockchain$_{[i]}$.transacciones$_{[j]}$.idVendedor)

    \}\\\\











% Fin de Procesos y Predicados, inicio de Auxiliares
\newpage
\section*{Auxiliares}

    \textbf{aux MontoDeUsuario} (id: \Entero; B: BerretaCoin): \Entero =\\

        \indent\indent
        $\mathlarger\sum\limits_{j=0}^{|bloques| - 1}
        [\mathlarger\sum\limits_{i=0}^{|bloques_{[j]}.transacciones|-1} (ifThenElse (bloques_{[j]}.transacciones_{[i]}.idComprador = id,\\
        \indent\indent\indent\indent\indent\indent\indent\indent\indent\indent\indent\indent bloques_{[j]}.transacciones_{[i]}.monto, 0))$ + \\

        \indent\indent\indent\indent\indent
        $\mathlarger\sum\limits_{i=0}^{bloques_{[j]}.transacciones|-1} (ifThenElse (bloques_{[j]}.transacciones_{[i]}.idVendedor = id,\\
        \indent\indent\indent\indent\indent\indent\indent\indent\indent\indent\indent\indent bloques_{[j]}.transacciones_{[i]}.monto, 0))$ ]\\\\\\

    \textbf{aux montoDeUsuarioHastaTransaccion} (id: \Entero, S: bloque, B: BerretaCoin, pos: \Entero) =\\\\
        \indent\indent montoDeUsuario(id, B) +\\\\
        \indent\indent [ $\mathlarger\sum\limits_{i=0}^{pos} (ifThenElse (S.transacciones_{[i]}.idComprador = id, bloques_{[j]}.transacciones_{[i]}.monto, 0))$\\\\\\
        \indent\indent+\\

        \indent\indent $\mathlarger\sum\limits_{i=0}^{pos} (ifThenElse (S.transacciones_{[i]}.idVendedor = id, bloques_{[j]}.transacciones_{[i]}.monto, 0))$ ]\\\\

    \textbf{aux promedio} (bloques: seq$<$bloques$>$): Float = \\

        \indent\indent $\mathlarger\sum\limits_{j=0}^{|bloques|-1} (\mathlarger\sum\limits_{i=0}^{|bloques_{[j]}.transacciones|-1}
        (ifThenElse (bloques_{[j]}.transacciones_{[i]}.idComprador \ne 0),\\
        \indent\indent\indent\indent\indent\indent\indent\indent\indent\indent\indent\indent bloques_{[j]}.transacciones_{{i}}.monto, 0))$

        \indent\indent$\frac{}{\mathlarger\sum\limits_{j=0}^{|bloques|-1} \left(\mathlarger\sum\limits_{i=0}^{|bloques_{[j]}.transacciones|-1} (ifThenElse(bloques_{[j]}.transacciones_{[i]}.idComprador \ne 0, 1, 0))\right)\indent\indent\indent}$\\\\\\\\

    \textbf{aux cotizarBloque} (posicion: \Entero, cotizaciones: Seq$<$\Entero$>$, blockchain: Seq$<$bloques$>$): \Entero =\\

        \indent\indent $\left( \mathlarger{\sum\limits_{i=0}^{|blockchain[posicion]|-1} blockchain[posicion].transacciones_{[i]}.montos} \right) * \text{cotizaciones}[posicion]$\\\\\\



\section*{\}}

\newpage
\section*{Anotaciones y Cosas a reubicar después}
cadenaDeBloques = \tuplaDeTuplaDeCuatroEnteros

bloque = struct(transacciones: seq$<$struct (idTransaccion:\Entero, idComprador:\Entero,
                                            idVendedor:\Entero, monto:\Entero)$>$, idBloque:\Entero)

\subsection*{Procs}
\textbf{proc montosDeUsuarios} \{

        \indent\indent \textbf{asegura} \{ $\forall$id $\in$ sinRepetidos (Usuarios (Cripto.blockchain)) $\rightarrow$ id $\in$ res\\
        \indent\indent\indent\indent\indent $\longleftrightarrow$ (esMaximo (MontoDeUsuario (Cripto.blockchain, id));
                                            Montos (Usuarios (Cripto.blockchain))) \}

    \}\\\\

\textbf{proc Usuarios} (in bc: BerretaCoin): Seq$<$\Entero$>$ \{

    \indent\indent \textbf{asegura} \{ ($\forall$i: \Entero) ($0 \le i < |bc.blockchain|$) \}\\

    \indent\indent \textbf{asegura} \{ ($\forall$j: \Entero) ($0 \le i < |bc.blockchain_{[i]}|$) \}\\

    \indent\indent \textbf{asegura} \{$ (bc.blockchain_{[i][j][1]} \land bc.blockchain_{[i][j][2]}) \in res$
                                            $\land$ ningunOtroElem $\in res$ \}
    
    \}\\\\

\subsection*{Preds}
    \textbf{pred esTransaccionCreacion} (t: \tuplaDeCuatroEnteros) \{\\
        \indent\indent t$_{[1]}$ = 0

    \}\\\\

    \textbf{pred sinRepetirId} (ids: \tuplaDeDosEnteros) \{\\
        \indent\indent($\forall$i,j: \Natural) ((0 $\leq$ i $<|$ids$|$ $\land_L$ (0 $\leq$ j $<|$ids$|$ $\land_L$ (j $\neq$ i))
                        $\rightarrow_L$ id$_{[i][0]} \neq$ id$_{[j][0]}$))
                        
    \}\\\\

    \textbf{pred esMaximo} (Monto: \Entero, Montos: Seq\textless$\mathds{Z}$\textgreater) \{\\
        \indent\indent($\forall$i $\in$ Montos) $\rightarrow_L$ Monto $\geq$ i

    \}\\\\

    \textbf{pred esTransaccionValida} (b: \tuplaDeCuatroEnteros, ids: \tuplaDeDosEnteros) \{

        \indent\indent($\forall$i,j: \Natural) (j $\leq$ i \textless $|b|$ $\land_L$ (0 $\leq$ j \textless $|ids|$) $\land_L$ ($b_{[i][2]} = ids_{[j][0]}$))
                                                $\rightarrow_L$ ($b_{[i][3]} \leq ids_{[j][1]}$)

    \}\\\\

\subsection*{Auxs}
    \textbf{aux Montos} (S: Seq\textless$\mathds{Z}$\textgreater): Seq\textless$\mathds{Z}$\textgreater = \\

        \indent\indent $\mathlarger\sum\limits_{j=0}^{|s|-1} (MontoDeUsuario(S_{[i]}))$\\\\\\

    \textbf{aux sinRepetidos} (S: Seq\textless$\mathds{Z}$\textgreater): Seq\textless$\mathds{Z}$\textgreater =\\\\
        \indent\indent $[S_{[0]}] + \mathlarger\sum\limits_{i=1}^{|s|-1} ifThenElse(S_{[i]} \in SubSeq(S, 0, i-1); \emptyset; [S_{[i]}])$ \\\\\\\\

    \textbf{aux Usuarios} (S:\tuplaDeTuplaDeCuatroEnteros): Seq\textless$\mathds{Z}$\textgreater=\\

    \indent\indent $\mathlarger\sum\limits_{i=0}^{|s|-i} \mathlarger\sum\limits_{j=0}^{|s_{[i]}|-1} (S_{[i][j][1]}, S_{[i][j][2]})$\\\\\\


\end{document}